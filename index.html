<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inscription — Espace Professionnel</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f5f2ed;
    --bg-card: #ffffff;
    --primary: #1a3a5c;
    --primary-light: #2d5f8a;
    --accent: #c7552e;
    --accent-light: #e8714a;
    --text: #1e1e1e;
    --text-muted: #6b7280;
    --border: #ddd6cc;
    --border-focus: #1a3a5c;
    --success: #16803c;
    --success-bg: #ecfdf5;
    --error: #dc2626;
    --error-bg: #fef2f2;
    --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-lg: 0 10px 40px rgba(0,0,0,0.08);
    --radius: 10px;
    --radius-sm: 6px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  body::before {
    content: '';
    position: fixed;
    top: -200px;
    right: -200px;
    width: 600px;
    height: 600px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(26,58,92,0.04) 0%, transparent 70%);
    pointer-events: none;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -300px;
    left: -200px;
    width: 700px;
    height: 700px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(199,85,46,0.04) 0%, transparent 70%);
    pointer-events: none;
  }

  header {
    width: 100%;
    padding: 28px 40px;
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .logo-mark {
    width: 38px; height: 38px;
    background: var(--primary);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    color: white; font-weight: 700; font-size: 16px;
    letter-spacing: -0.5px;
    font-family: 'Playfair Display', serif;
  }
  .logo-text {
    font-family: 'Playfair Display', serif;
    font-size: 20px; font-weight: 700;
    color: var(--primary);
  }

  main {
    width: 100%;
    max-width: 680px;
    padding: 10px 24px 60px;
    position: relative;
    z-index: 1;
  }

  .page-title {
    font-family: 'Playfair Display', serif;
    font-size: 32px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 6px;
  }
  .page-subtitle {
    color: var(--text-muted);
    font-size: 15px;
    margin-bottom: 36px;
    line-height: 1.5;
  }

  .card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 36px;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(0,0,0,0.04);
  }

  .section-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1.6px;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .field {
    margin-bottom: 20px;
    position: relative;
  }

  label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 6px;
  }
  label .required {
    color: var(--accent);
    margin-left: 2px;
  }

  input, select {
    width: 100%;
    padding: 12px 14px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    color: var(--text);
    background: #fff;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }
  input:focus, select:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(26,58,92,0.08);
  }
  input.autofilled {
    background: var(--success-bg);
    border-color: var(--success);
    animation: fillPulse 0.5s ease;
  }
  @keyframes fillPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.005); }
    100% { transform: scale(1); }
  }
  input[readonly] {
    background: #f9f9f7;
    color: var(--text-muted);
    cursor: default;
  }

  .search-wrapper {
    position: relative;
  }
  .search-wrapper input {
    padding-right: 44px;
  }
  .search-icon {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    pointer-events: none;
  }
  .spinner {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px; height: 20px;
    border: 2px solid var(--border);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    display: none;
  }
  @keyframes spin { to { transform: translateY(-50%) rotate(360deg); } }

  .autocomplete-list {
    position: absolute;
    top: 100%;
    left: 0; right: 0;
    background: #fff;
    border: 1.5px solid var(--border);
    border-top: none;
    border-radius: 0 0 var(--radius-sm) var(--radius-sm);
    max-height: 280px;
    overflow-y: auto;
    z-index: 100;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    display: none;
  }
  .autocomplete-list.visible { display: block; }

  .autocomplete-item {
    padding: 12px 14px;
    cursor: pointer;
    border-bottom: 1px solid #f3f0eb;
    transition: background 0.15s;
  }
  .autocomplete-item:last-child { border-bottom: none; }
  .autocomplete-item:hover, .autocomplete-item.active {
    background: #f5f2ed;
  }
  .autocomplete-item .company-name {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
    color: var(--primary);
  }
  .autocomplete-item .company-detail {
    font-size: 12px;
    color: var(--text-muted);
  }
  .autocomplete-item .company-detail .siret-tag {
    background: rgba(26,58,92,0.08);
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 11px;
    font-weight: 500;
    margin-right: 6px;
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }
  .row-3 {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 16px;
  }

  .info-banner {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 14px 16px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    line-height: 1.5;
    margin-bottom: 24px;
  }
  .info-banner.info {
    background: #eff6ff;
    border: 1px solid #bfdbfe;
    color: #1e40af;
  }
  .info-banner.success {
    background: var(--success-bg);
    border: 1px solid #bbf7d0;
    color: #166534;
    display: none;
  }
  .info-banner.error {
    background: var(--error-bg);
    border: 1px solid #fecaca;
    color: var(--error);
    display: none;
  }
  .info-banner svg { flex-shrink: 0; margin-top: 1px; }

  .divider {
    height: 1px;
    background: var(--border);
    margin: 28px 0;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 4px;
    margin-left: 8px;
  }
  .badge.auto {
    background: rgba(22,128,60,0.1);
    color: var(--success);
  }

  /* Source tag */
  .source-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 8px;
    padding: 4px 10px;
    background: #f9f9f7;
    border-radius: 4px;
    border: 1px solid var(--border);
  }
  .source-tag svg { opacity: 0.5; }

  button.submit-btn {
    width: 100%;
    padding: 14px 28px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    margin-top: 8px;
    letter-spacing: 0.2px;
  }
  button.submit-btn:hover {
    background: var(--primary-light);
  }
  button.submit-btn:active {
    transform: scale(0.995);
  }

  .terms {
    text-align: center;
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 16px;
    line-height: 1.5;
  }
  .terms a {
    color: var(--primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .no-results {
    padding: 16px;
    text-align: center;
    color: var(--text-muted);
    font-size: 13px;
  }

  @media (max-width: 600px) {
    main { padding: 10px 16px 40px; }
    .card { padding: 24px 20px; }
    .row, .row-3 { grid-template-columns: 1fr; }
    .page-title { font-size: 26px; }
    header { padding: 20px 20px; }
  }
</style>
</head>
<body>

<header>
  <div class="logo-mark">EP</div>
  <div class="logo-text">Espace Pro</div>
</header>

<main>
  <h1 class="page-title">Créer votre compte</h1>
  <p class="page-subtitle">Recherchez votre entreprise pour préremplir automatiquement vos informations depuis l'annuaire officiel des entreprises françaises.</p>

  <div class="card">

    <!-- SECTION 1 -->
    <div class="section-label">Votre entreprise</div>

    <div class="info-banner info" id="infoBanner">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
      <span>Saisissez le nom, le SIRET ou le SIREN de votre entreprise. Les données seront récupérées automatiquement depuis la base Sirene officielle.</span>
    </div>

    <div class="info-banner success" id="successBanner">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      <span id="successText"></span>
    </div>

    <div class="info-banner error" id="errorBanner">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
      <span id="errorText"></span>
    </div>

    <div class="field">
      <label for="searchEntreprise">Nom de l'entreprise ou SIRET <span class="required">*</span></label>
      <div class="search-wrapper">
        <input type="text" id="searchEntreprise" placeholder="Ex : Dassault Systèmes, 443 061 841..." autocomplete="off">
        <svg class="search-icon" id="searchIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <div class="spinner" id="spinner"></div>
        <div class="autocomplete-list" id="autocompleteList"></div>
      </div>
      <div class="source-tag">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        Source : API Sirene — données officielles INSEE
      </div>
    </div>

    <div class="divider"></div>

    <!-- SECTION 2 -->
    <div class="section-label">Informations légales <span class="badge auto" id="autoBadge" style="display:none;">✓ Auto-rempli</span></div>

    <div class="field">
      <label for="denomination">Dénomination sociale</label>
      <input type="text" id="denomination" readonly placeholder="—">
    </div>

    <div class="row">
      <div class="field">
        <label for="siret">SIRET (14 chiffres)</label>
        <input type="text" id="siret" readonly placeholder="—">
      </div>
      <div class="field">
        <label for="siren">SIREN (9 chiffres)</label>
        <input type="text" id="siren" readonly placeholder="—">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="naf">Code NAF / APE</label>
        <input type="text" id="naf" readonly placeholder="—">
      </div>
      <div class="field">
        <label for="formeJuridique">Forme juridique</label>
        <input type="text" id="formeJuridique" readonly placeholder="—">
      </div>
    </div>

    <div class="divider"></div>

    <!-- SECTION 3 -->
    <div class="section-label">Adresse du siège <span class="badge auto" id="autoBadgeAddr" style="display:none;">✓ Auto-rempli</span></div>

    <div class="field">
      <label for="adresse">Adresse</label>
      <input type="text" id="adresse" readonly placeholder="—">
    </div>

    <div class="row-3">
      <div class="field">
        <label for="codePostal">Code postal</label>
        <input type="text" id="codePostal" readonly placeholder="—">
      </div>
      <div class="field">
        <label for="ville">Ville</label>
        <input type="text" id="ville" readonly placeholder="—">
      </div>
    </div>

    <div class="divider"></div>

    <!-- SECTION 4 -->
    <div class="section-label">Vos coordonnées</div>

    <div class="row">
      <div class="field">
        <label for="prenom">Prénom <span class="required">*</span></label>
        <input type="text" id="prenom" placeholder="Jean">
      </div>
      <div class="field">
        <label for="nom">Nom <span class="required">*</span></label>
        <input type="text" id="nom" placeholder="Dupont">
      </div>
    </div>

    <div class="field">
      <label for="email">Adresse e-mail <span class="required">*</span></label>
      <input type="email" id="email" placeholder="jean.dupont@entreprise.fr">
    </div>

    <div class="field">
      <label for="telephone">Téléphone</label>
      <input type="tel" id="telephone" placeholder="06 12 34 56 78">
    </div>

    <div class="field">
      <label for="password">Mot de passe <span class="required">*</span></label>
      <input type="password" id="password" placeholder="Minimum 8 caractères">
    </div>

    <button class="submit-btn" id="submitBtn" onclick="handleSubmit()">Créer mon compte</button>

    <p class="terms">En vous inscrivant, vous acceptez nos <a href="#">Conditions d'utilisation</a> et notre <a href="#">Politique de confidentialité</a>.</p>
  </div>
</main>

<script>
  const searchInput = document.getElementById('searchEntreprise');
  const autocompleteList = document.getElementById('autocompleteList');
  const spinner = document.getElementById('spinner');
  const searchIcon = document.getElementById('searchIcon');
  const successBanner = document.getElementById('successBanner');
  const errorBanner = document.getElementById('errorBanner');
  const infoBanner = document.getElementById('infoBanner');
  const autoBadge = document.getElementById('autoBadge');
  const autoBadgeAddr = document.getElementById('autoBadgeAddr');

  let debounceTimer;
  let activeIndex = -1;
  let currentResults = [];

  /* ─── API Recherche Entreprises (gouv.fr) ─────────────────── */
  async function searchEntreprise(query) {
    if (!query || query.length < 2) {
      autocompleteList.classList.remove('visible');
      return;
    }
    spinner.style.display = 'block';
    searchIcon.style.display = 'none';
    errorBanner.style.display = 'none';

    try {
      const url = `https://recherche-entreprises.api.gouv.fr/search?q=${encodeURIComponent(query)}&page=1&per_page=8`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Erreur API');
      const data = await res.json();
      currentResults = data.results || [];
      renderAutocomplete(currentResults);
    } catch (err) {
      autocompleteList.innerHTML = '<div class="no-results">Erreur de connexion. Vérifiez votre accès internet.</div>';
      autocompleteList.classList.add('visible');
    } finally {
      spinner.style.display = 'none';
      searchIcon.style.display = 'block';
    }
  }

  /* ─── Autocomplete rendering ──────────────────────────────── */
  function renderAutocomplete(results) {
    if (!results.length) {
      autocompleteList.innerHTML = '<div class="no-results">Aucune entreprise trouvée. Essayez avec le SIRET ou un autre nom.</div>';
      autocompleteList.classList.add('visible');
      return;
    }
    autocompleteList.innerHTML = results.map((r, i) => {
      const siege = r.siege || {};
      const nom = r.nom_complet || r.nom_raison_sociale || '—';
      const siret = siege.siret || '—';
      const ville = siege.libelle_commune || '';
      const cp = siege.code_postal || '';
      const loc = [cp, ville].filter(Boolean).join(' ');
      return `
        <div class="autocomplete-item" data-index="${i}" onclick="selectEntreprise(${i})">
          <div class="company-name">${hl(nom, searchInput.value)}</div>
          <div class="company-detail"><span class="siret-tag">SIRET ${siret}</span>${loc}</div>
        </div>`;
    }).join('');
    autocompleteList.classList.add('visible');
    activeIndex = -1;
  }

  function hl(text, q) {
    if (!q) return text;
    const re = new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi');
    return text.replace(re, '<strong>$1</strong>');
  }

  /* ─── Formes juridiques ───────────────────────────────────── */
  const FJ = {
    '1000':'Entrepreneur individuel','5410':'SARL','5499':'EURL',
    '5505':'SA à conseil d\'administration','5510':'SA à conseil d\'administration',
    '5599':'SA à directoire','5710':'SAS','5720':'SASU',
    '6540':'SCI','6599':'Société civile',
    '9220':'Association déclarée','9221':'Association reconnue d\'utilité publique',
  };
  function getFormeJuridique(code) {
    if (!code) return '—';
    if (FJ[code]) return FJ[code] + ` (${code})`;
    const c = parseInt(code);
    if (c >= 1000 && c < 2000) return `Entrepreneur individuel (${code})`;
    if (c >= 5410 && c <= 5499) return `SARL (${code})`;
    if (c >= 5500 && c <= 5599) return `SA (${code})`;
    if (c >= 5700 && c <= 5720) return `SAS (${code})`;
    if (c >= 6500 && c <= 6599) return `Société civile (${code})`;
    if (c >= 9200 && c <= 9299) return `Association (${code})`;
    if (c >= 7000 && c <= 7999) return `Personne morale de droit public (${code})`;
    return `Code ${code}`;
  }

  /* ─── Select & autofill ───────────────────────────────────── */
  function selectEntreprise(index) {
    const r = currentResults[index];
    if (!r) return;
    const siege = r.siege || {};
    const nom = r.nom_complet || r.nom_raison_sociale || '';
    searchInput.value = nom;
    autocompleteList.classList.remove('visible');

    const adresseParts = [];
    if (siege.numero_voie) adresseParts.push(siege.numero_voie);
    if (siege.type_voie) adresseParts.push(siege.type_voie);
    if (siege.libelle_voie) adresseParts.push(siege.libelle_voie);
    if (siege.complement_adresse) adresseParts.push(siege.complement_adresse);
    const adresseStr = adresseParts.join(' ') || siege.geo_adresse || '—';

    const nafCode = siege.activite_principale || r.activite_principale || '';
    const nafLabel = siege.libelle_activite_principale || '';
    const nafFull = nafCode ? (nafLabel ? `${nafCode} — ${nafLabel}` : nafCode) : '—';

    const fields = {
      denomination: nom,
      siret: siege.siret || '—',
      siren: r.siren || '—',
      naf: nafFull,
      formeJuridique: getFormeJuridique(r.nature_juridique),
      adresse: adresseStr,
      codePostal: siege.code_postal || '—',
      ville: siege.libelle_commune || '—',
    };

    let delay = 0;
    for (const [id, value] of Object.entries(fields)) {
      setTimeout(() => {
        const el = document.getElementById(id);
        el.value = value;
        el.classList.add('autofilled');
        setTimeout(() => el.classList.remove('autofilled'), 1500);
      }, delay);
      delay += 80;
    }

    infoBanner.style.display = 'none';
    errorBanner.style.display = 'none';
    successBanner.style.display = 'flex';
    document.getElementById('successText').textContent = `✓ ${nom} — Les informations ont été préremplies automatiquement.`;
    autoBadge.style.display = 'inline-flex';
    autoBadgeAddr.style.display = 'inline-flex';
  }

  /* ─── Events ──────────────────────────────────────────────── */
  searchInput.addEventListener('input', (e) => {
    const q = e.target.value.trim();
    clearTimeout(debounceTimer);
    if (q.length < 2) { autocompleteList.classList.remove('visible'); return; }
    debounceTimer = setTimeout(() => searchEntreprise(q), 300);
  });

  searchInput.addEventListener('keydown', (e) => {
    const items = autocompleteList.querySelectorAll('.autocomplete-item');
    if (!items.length) return;
    if (e.key === 'ArrowDown') { e.preventDefault(); activeIndex = Math.min(activeIndex+1, items.length-1); upd(items); }
    else if (e.key === 'ArrowUp') { e.preventDefault(); activeIndex = Math.max(activeIndex-1, 0); upd(items); }
    else if (e.key === 'Enter' && activeIndex >= 0) { e.preventDefault(); selectEntreprise(activeIndex); }
    else if (e.key === 'Escape') autocompleteList.classList.remove('visible');
  });

  function upd(items) {
    items.forEach(i => i.classList.remove('active'));
    if (items[activeIndex]) { items[activeIndex].classList.add('active'); items[activeIndex].scrollIntoView({block:'nearest'}); }
  }

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-wrapper')) autocompleteList.classList.remove('visible');
  });

  function handleSubmit() {
    const req = ['searchEntreprise','prenom','nom','email','password'];
    let ok = true;
    for (const id of req) {
      const el = document.getElementById(id);
      if (!el.value.trim()) { el.style.borderColor='var(--error)'; ok=false; setTimeout(()=>{el.style.borderColor='';},2000); }
    }
    if (!ok) {
      errorBanner.style.display = 'flex';
      document.getElementById('errorText').textContent = 'Veuillez remplir tous les champs obligatoires.';
      return;
    }
    alert('Inscription envoyée avec succès ! (démo)');
  }
</script>

</body>
</html>
